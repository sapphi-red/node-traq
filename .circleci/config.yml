version: 2

jobs:
  build:
    docker:
      - image: circleci/openjdk:latest-node
    working_directory: ~/work_dir
    steps:
      - checkout
      - run:
          name: npm ci
          command: |
            npm ci
      - run:
          name: build
          command: |
            npm run build
      - deploy:
          name: Check diff, commit and push
          command: |
            git diff --unified=0 > ./diff.txt
            if [ -s './diff.txt' ]; then
              rm ./diff.txt
              git config user.name "sapphi-red+circleci"
              git config user.email "sapphi-red+circleci@users.noreply.github.com"
              git add .
              git commit -m "CI\: build"
              git push origin
            else
              echo 'There are no difference.'
            fi
